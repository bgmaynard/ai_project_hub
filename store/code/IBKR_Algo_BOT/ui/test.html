<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>AI Bot Test Panel</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;padding:16px;max-width:1000px;margin:0 auto}
    h1{margin:0 0 12px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{border:1px solid #ddd;border-radius:10px;padding:12px;flex:1 1 320px}
    textarea, input, button{font:inherit}
    textarea{width:100%;height:120px}
    pre{white-space:pre-wrap;background:#f7f7f7;border-radius:8px;padding:8px}
  </style>
</head>
<body>
  <h1>AI Bot – Test Panel</h1>
  <div class="row">
    <div class="card">
      <h3>Health / Status</h3>
      <button onclick="getJSON('/health')">GET /health</button>
      <button onclick="getJSON('/api/status')">GET /api/status</button>
      <button onclick="getJSON('/api/tws/ping')">GET /api/tws/ping</button>
    </div>
    <div class="card">
      <h3>/api/ai/predict</h3>
      <p>Either specify <b>symbol</b> (uses IBKR L1 if connected) or fill manual fields.</p>
      <label>symbol: <input id="sym" placeholder="AAPL"/></label><br/>
      <small>Manual fields (fallback):</small><br/>
      <label>bid: <input id="bid" type="number" step="0.0001"/></label>
      <label>ask: <input id="ask" type="number" step="0.0001"/></label>
      <label>bidSize: <input id="bidSize" type="number" step="1"/></label>
      <label>askSize: <input id="askSize" type="number" step="1"/></label>
      <label>vwap: <input id="vwap" type="number" step="0.0001"/></label>
      <label>lastMid: <input id="lastMid" type="number" step="0.0001"/></label>
      <label>sentiment: <input id="sent" type="number" step="0.01" value="0"/></label>
      <label>similarityWinrate: <input id="simw" type="number" step="0.01" min="0" max="1"/></label>
      <br/><button onclick="postPredict()">POST /api/ai/predict</button>
        <div class="card">
      <h3>Decision Policy</h3>
      <label>theta: <input id="theta" type="number" step="0.01" value="0.6"/></label>
      <label>maxQty: <input id="maxQty" type="number" step="1" value="1"/></label>
      <br/><button onclick="postDecide()">POST /api/orders/decide</button>
    </div>
  </div>
  <div class="row">
    <div class="card">
      <h3>Logs</h3>
      <button onclick="getText('/api/orders/logs/tail?n=200')">GET /api/orders/logs/tail</button>
      <button onclick="getJSON('/api/orders/log_test')">POST /api/orders/log_test</button>
    </div>
  </div>
  <h3>Response</h3>
  <pre id="out"></pre>
<script>
async function getJSON(path){
  const r = await fetch(path); document.getElementById('out').textContent = await r.text();
}
async function postPredict(){
  const body = {
    symbol: val('sym'),
    bid: num('bid'), ask: num('ask'),
    bidSize: num('bidSize'), askSize: num('askSize'),
    vwap: num('vwap'), lastMid: num('lastMid'),
    sentiment: num('sent'), similarityWinrate: num('simw')
  };
  const r = await fetch('/api/ai/predict', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
  document.getElementById('out').textContent = await r.text();
}
function val(id){ const v = document.getElementById(id).value.trim(); return v.length? v : null; }
function num(id){ const v = document.getElementById(id).value; return v===''? null : Number(v); }
async function postDecide(){
  const body = {
    symbol: val('sym'),
    bid: num('bid'), ask: num('ask'),
    bidSize: num('bidSize'), askSize: num('askSize'),
    vwap: num('vwap'), lastMid: num('lastMid'),
    sentiment: num('sent'), similarityWinrate: num('simw'),
    theta: num('theta'), maxQty: num('maxQty')
  };
  const r = await fetch('/api/orders/decide', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
  document.getElementById('out').textContent = await r.text();
}
async function getText(path){
  const r = await fetch(path);
  document.getElementById('out').textContent = await r.text();
}
</script></body>
</html>


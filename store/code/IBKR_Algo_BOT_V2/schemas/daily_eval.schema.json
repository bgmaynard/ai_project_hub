{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DERO Daily Evaluation Report",
  "description": "Schema for daily trading evaluation reports generated by DERO",
  "type": "object",
  "required": ["date", "mode", "data_health"],
  "properties": {
    "date": {
      "type": "string",
      "format": "date",
      "description": "Report date in YYYY-MM-DD format"
    },
    "mode": {
      "type": "string",
      "enum": ["PAPER", "LIVE"],
      "description": "Trading mode"
    },
    "data_health": {
      "type": "string",
      "enum": ["GREEN", "YELLOW", "RED"],
      "description": "Overall data health status"
    },
    "market": {
      "type": "object",
      "description": "Market context (regime)",
      "properties": {
        "regime": {
          "type": "string",
          "enum": ["TREND", "CHOP", "NEWS", "DEAD", "UNKNOWN"]
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "features": {
          "type": "object",
          "properties": {
            "trend_slope": { "type": "number" },
            "realized_volatility": { "type": "number" },
            "range_expansion": { "type": "number" },
            "choppiness_index": { "type": "number" },
            "volume_ratio": { "type": "number" }
          }
        }
      }
    },
    "time_context": {
      "type": "object",
      "description": "Session time context",
      "properties": {
        "date": { "type": "string" },
        "timezone": { "type": "string" },
        "total_events": { "type": "integer" },
        "market_hours_events": { "type": "integer" },
        "premarket_events": { "type": "integer" },
        "event_window_counts": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        }
      }
    },
    "infrastructure": {
      "type": "object",
      "description": "Infrastructure health metrics",
      "properties": {
        "data_health": { "type": "string" },
        "feed_uptime_pct": { "type": "number" },
        "error_count": { "type": "integer" },
        "reconnect_count": { "type": "integer" },
        "feed_drops": { "type": "integer" },
        "total_events": { "type": "integer" }
      }
    },
    "discovery": {
      "type": "object",
      "description": "Scanner/discovery metrics",
      "properties": {
        "total_candidates": { "type": "integer" },
        "unique_symbols": { "type": "integer" },
        "symbols_added": { "type": "integer" },
        "symbols_removed": { "type": "integer" },
        "churn": { "type": "integer" },
        "candidates_by_scanner": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "symbol_list": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "pipeline": {
      "type": "object",
      "description": "FSM pipeline flow metrics",
      "properties": {
        "state_counts": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "total_transitions": { "type": "integer" },
        "funnel": {
          "type": "object",
          "properties": {
            "discovery_to_ignition": { "type": "integer" },
            "ignition_to_confirmed": { "type": "integer" },
            "confirmed_to_gated": { "type": "integer" }
          }
        }
      }
    },
    "gating": {
      "type": "object",
      "description": "Gating decision metrics",
      "properties": {
        "total_decisions": { "type": "integer" },
        "allowed": { "type": "integer" },
        "blocked": { "type": "integer" },
        "approval_rate_pct": { "type": "number" },
        "top_block_reasons": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "reason": { "type": "string" },
              "count": { "type": "integer" }
            }
          }
        }
      }
    },
    "outcomes": {
      "type": "object",
      "description": "Trade outcome metrics",
      "properties": {
        "total_trades": { "type": "integer" },
        "wins": { "type": "integer" },
        "losses": { "type": "integer" },
        "breakeven": { "type": "integer" },
        "win_rate_pct": { "type": "number" },
        "total_pnl": { "type": "number" },
        "avg_r": { "type": "number" },
        "avg_mae": { "type": "number" },
        "avg_mfe": { "type": "number" },
        "avg_slippage": { "type": "number" },
        "trade_details": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "symbol": { "type": "string" },
              "pnl": { "type": "number" },
              "r_multiple": { "type": "number" },
              "entry_time": { "type": "string" }
            }
          }
        }
      }
    },
    "patterns": {
      "type": "object",
      "description": "Pattern analysis results",
      "properties": {
        "pattern_flags": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "category": { "type": "string" },
              "severity": {
                "type": "string",
                "enum": ["NONE", "POSSIBLE", "CONFIRMED"]
              },
              "count_lookback": { "type": "integer" },
              "count_hits": { "type": "integer" },
              "description": { "type": "string" },
              "suggested_action": { "type": "string" }
            }
          }
        },
        "summary": {
          "type": "object",
          "properties": {
            "total_patterns": { "type": "integer" },
            "confirmed": { "type": "integer" },
            "possible": { "type": "integer" },
            "sessions_analyzed": { "type": "integer" },
            "green_sessions": { "type": "integer" }
          }
        }
      }
    },
    "artifacts": {
      "type": "object",
      "description": "Report metadata",
      "properties": {
        "raw_events_sources": {
          "type": "array",
          "items": { "type": "string" }
        },
        "report_version": { "type": "string" },
        "generated_at": { "type": "string", "format": "date-time" }
      }
    }
  }
}
